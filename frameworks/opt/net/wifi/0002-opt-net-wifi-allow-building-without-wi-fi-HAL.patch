From 9c416092d4d433016ffd94dba71e56391c82a8a1 Mon Sep 17 00:00:00 2001
From: Arne Coucheron <arco68@gmail.com>
Date: Wed, 3 Dec 2014 07:51:12 +0100
Subject: [PATCH 2/2] opt: net: wifi: allow building without wi-fi HAL

 * For example devices with older broadcom chips with driver built
   as module doesn't like this. When the device goes into suspend
   mode, the wifi service crashes and the device soft reboots.

 * To not build the HAL, use:
   BOARD_NO_WIFI_HAL := true

complements: https://gerrit.omnirom.org/10997

Change-Id: Ia186ce3a59a082cfe98d283492fa450014af52f4
---
 service/Android.mk |   18 ++++++++++--------
 1 file changed, 10 insertions(+), 8 deletions(-)

diff --git a/service/Android.mk b/service/Android.mk
index af39433..a6cc6b0 100644
--- a/service/Android.mk
+++ b/service/Android.mk
@@ -42,14 +42,16 @@ include $(BUILD_STATIC_LIBRARY)
 # ============================================================
 LIB_WIFI_HAL := libwifi-hal
 
-ifeq ($(BOARD_WLAN_DEVICE), bcmdhd)
-  LIB_WIFI_HAL := libwifi-hal-bcm
-else ifeq ($(BOARD_WLAN_DEVICE), qcwcn)
-  LIB_WIFI_HAL := libwifi-hal-qcom
-else ifeq ($(BOARD_WLAN_DEVICE), mrvl)
-  # this is commented because none of the nexus devices
-  # that sport Marvell's wifi have support for HAL
-  # LIB_WIFI_HAL := libwifi-hal-mrvl
+ifneq ($(BOARD_NO_WIFI_HAL), true)
+  ifeq ($(BOARD_WLAN_DEVICE), bcmdhd)
+    LIB_WIFI_HAL := libwifi-hal-bcm
+  else ifeq ($(BOARD_WLAN_DEVICE), qcwcn)
+    LIB_WIFI_HAL := libwifi-hal-qcom
+  else ifeq ($(BOARD_WLAN_DEVICE), mrvl)
+    # this is commented because none of the nexus devices
+    # that sport Marvell's wifi have support for HAL
+    # LIB_WIFI_HAL := libwifi-hal-mrvl
+  endif
 endif
 
 # Build the HalUtil
-- 
1.7.9.5


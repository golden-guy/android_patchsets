From 8b6394dbe57bc47474163481960c308a018b902a Mon Sep 17 00:00:00 2001
From: Stefan Berger <s.berger81@gmail.com>
Date: Fri, 25 Mar 2016 11:32:44 +0100
Subject: [PATCH] base: Allow manual confirm on every shutdown

To be toggled via optional ro.config.shutdown.confirm
If not defined or set to false, standard behaviour applies.
If set to true, every shutdown or reboot will prompt for confirmation.

Change-Id: I8d6fc1e85923945c4a5712be53c236a31cd9048c
---
 .../com/android/server/power/ShutdownThread.java   |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/services/core/java/com/android/server/power/ShutdownThread.java b/services/core/java/com/android/server/power/ShutdownThread.java
index 8d9941a..dc47f6f 100644
--- a/services/core/java/com/android/server/power/ShutdownThread.java
+++ b/services/core/java/com/android/server/power/ShutdownThread.java
@@ -69,6 +69,8 @@ public final class ShutdownThread extends Thread {
     private static boolean mReboot;
     private static boolean mRebootSafeMode;
     private static String mRebootReason;
+    private static boolean mConfirmOverride =
+            SystemProperties.getBoolean("ro.config.shutdown.confirm", false);
 
     // Provides shutdown assurance in case the system_server is killed
     public static final String SHUTDOWN_ACTION_PROPERTY = "sys.shutdown.requested";
@@ -134,7 +136,7 @@ public final class ShutdownThread extends Thread {
         }
         Log.d(TAG, "Notifying thread to start shutdown longPressBehavior=" + longPressBehavior);
 
-        if (confirm) {
+        if (confirm || mConfirmOverride) {
             final CloseDialogReceiver closer = new CloseDialogReceiver(context);
             if (sConfirmDialog != null) {
                 sConfirmDialog.dismiss();
-- 
1.7.9.5

